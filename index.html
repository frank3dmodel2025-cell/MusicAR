<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Visor AR Nativo con model-viewer</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Fuente Poppins -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet" />

    <!-- Componente model-viewer de Google (MANDATORIO para AR nativa) -->
    <script type="module" src="https://ajax.googleapis.com/ajax/libs/model-viewer/3.4.0/model-viewer.min.js"></script>

    <style>
      body {
        font-family: 'Poppins', sans-serif;
        background-color: #f7f3ed;
        color: #3b4233;
        margin: 0;
        display: flex;
        flex-direction: column;
        align-items: center;
        min-height: 100vh;
      }
      /* Estilos para el componente model-viewer */
      model-viewer {
        width: 100%;
        height: 50vh; /* Ocupa mitad de la pantalla para el visor */
        margin: 16px 0;
        border-radius: 12px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
        background-color: #fff;
      }
      .container {
        width: 95%;
        max-width: 600px;
        padding: 16px;
      }
      .glass-panel {
        backdrop-filter: blur(10px) saturate(180%);
        background-color: rgba(255, 255, 255, 0.75);
        border: 1px solid rgba(255, 255, 255, 0.125);
        box-shadow: 0 8px 32px rgba(31, 38, 135, 0.37);
        border-radius: 12px;
        padding: 20px;
        margin-top: 20px;
      }
      button {
        transition: background-color 0.3s, transform 0.1s;
      }
      button:active {
        transform: scale(0.98);
      }
    </style>
</head>
<body>

  <div class="container">
    <h1 class="text-3xl font-bold text-center text-indigo-800 my-6">Galería AR Nativa (model-viewer)</h1>

    <!-- 
      El componente model-viewer reemplaza toda la lógica de Three.js y el giroscopio.
      Atributos clave para AR:
      1. src: Ruta al modelo (siempre GLB o GLTF).
      2. ar: Activa el modo AR.
      3. ar-modes: Define los modos compatibles (webxr, scene-viewer, quick-look).
      4. camera-controls: Permite rotación y zoom 3D.
      5. shadow-intensity: Hace que el modelo se vea más realista.
    -->
    <model-viewer
      id="model-viewer-element"
      src="https://cdn.jsdelivr.net/gh/KhronosGroup/glTF-Sample-Models@master/2.0/Duck/glTF/Duck.gltf"
      ar
      ar-modes="webxr scene-viewer quick-look"
      camera-controls
      shadow-intensity="1"
      alt="Modelo 3D para Realidad Aumentada"
      class="max-w-full mx-auto"
    >
      <!-- Botón AR automático que se muestra en dispositivos compatibles -->
      <div slot="ar-button" class="flex justify-center items-center w-full h-full bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-2 px-4 rounded-full shadow-lg">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 10l4.55 4.55a.5.5 0 010 .71L15 20.81a.5.5 0 01-.81-.39V16h-4a2 2 0 01-2-2v-4a2 2 0 012-2h4V3.59a.5.5 0 01.81-.39L15 8l4.55 4.55a.5.5 0 010 .71z" />
        </svg>
        Ver en tu mundo (AR)
      </div>
    </model-viewer>

    <!-- Panel de controles simplificado -->
    <div class="glass-panel w-full">
      <h2 class="text-xl font-bold mb-4 text-indigo-700">Seleccionar Modelo</h2>
      <div id="model-selector" class="space-y-3">
          <button class="px-4 py-2 rounded bg-indigo-500 text-white w-full" data-model="Duck">Pato (Duck)</button>
          <button class="px-4 py-2 rounded bg-gray-200 w-full" data-model="Helmet">Casco (Helmet)</button>
          <button class="px-4 py-2 rounded bg-gray-200 w-full" data-model="BoomBox">BoomBox</button>
      </div>
      <p class="text-sm text-gray-600 mt-4">Toca el modelo 3D para rotar/hacer zoom o el botón "Ver en tu mundo (AR)" para la Realidad Aumentada nativa de tu dispositivo.</p>
    </div>
  </div>

<script>
  const modelViewer = document.getElementById('model-viewer-element');
  const selector = document.getElementById('model-selector');

  const MODELS = {
    Duck: 'https://cdn.jsdelivr.net/gh/KhronosGroup/glTF-Sample-Models@master/2.0/Duck/glTF/Duck.gltf',
    Helmet: 'https://cdn.jsdelivr.net/gh/KhronosGroup/glTF-Sample-Models@master/2.0/DamagedHelmet/glTF/DamagedHelmet.gltf',
    BoomBox: 'https://cdn.jsdelivr.net/gh/KhronosGroup/glTF-Sample-Models@master/2.0/BoomBox/glTF/BoomBox.gltf'
  };

  /**
   * Updates the model-viewer source and button styles.
   * @param {string} name The model name (e.g., 'Duck').
   */
  function selectModel(name){
    const url = MODELS[name];
    if(url){
      modelViewer.src = url;
      modelViewer.alt = `Modelo 3D de ${name}`;

      // Update button styles
      selector.querySelectorAll('button').forEach(btn => {
        if(btn.dataset.model === name){
          btn.classList.remove('bg-gray-200', 'text-black');
          btn.classList.add('bg-indigo-500', 'text-white');
        } else {
          btn.classList.remove('bg-indigo-500', 'text-white');
          btn.classList.add('bg-gray-200', 'text-black');
        }
      });
    }
  }

  // Event listener for model selector buttons
  selector.addEventListener('click', (e) => {
    if(e.target.tagName === 'BUTTON' && e.target.dataset.model){
      selectModel(e.target.dataset.model);
    }
  });

  // Initial setup (Duck is already set in HTML, but good practice to call selectModel)
  document.addEventListener('DOMContentLoaded', () => {
    selectModel('Duck');
  });
</script>
</body>
</html>
